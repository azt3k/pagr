;(function($,t,e,a){"use strict";var r="pagr",i="0.1.11",n={bindTo:"tap click change",loadingSelector:"html",pageLinkSelector:".page-link",filterFormSelector:null,pager:{"class":"page-link",next:true,prev:true,range:3,first:true,last:true},forceFilter:false,ajax:false,method:"get",behaviour:"replace",vars:{sortDirection:"direction",sortBy:"sort",page:"page",pageSize:"page_size"},baseURL:t.location.href,pageSize:10,ajaxWait:0,urlHandler:null,ajaxHandler:null,onBeforePage:null,onAfterPage:null};function l(t,e,a,r){this.$element=$(t);this.idx=e;this.selector=a;this.settings=$.extend(true,{},n,r);this.init()}l.prototype={init:function(){var t=this.$element,e=this.settings,a=t.attr("id");t.addClass("pagr");if(!a){while(!a||$("#"+a).length){a=Math.floor(Math.random()*1e3)+1}t.attr("id",a)}if(["get","post"].indexOf(e.method)==-1)throw"invalid request method supplied";if(["append","replace"].indexOf(e.behaviour)==-1)throw"invalid behaviour supplied";this.attachPagination();if(!e.ajax||e.forceFilter){this.filter()}},attachPagination:function(){var t=this.$element,e,r,i=this,n,l=t.attr("data-page")?parseInt(t.attr("data-page")):1,s=this.settings,o=t.attr("id");if(s.pager){e=this.getContainer();r=$("#"+o+"-wrap");if(r.length)r.replaceWith(i.buildPager(l));else e.after(this.buildPager(l))}$(s.pageLinkSelector).each(function(e){var r=$(this),n=this,l=r.attr("data-bind-to")||s.bindTo,o=l.split(/[ ]+/).map(function(t){return t+".pagr"}).join(" ");r.off(o).on(o,function(e){var l=r.attr("data-allow-default");if(l==a||!l||l=="false")e.preventDefault();if(r.is(".disabled"))return;if(typeof s.onBeforePage=="function")s.onBeforePage.call(n,i,e);var o=i.baseURL(),d=i.currentPage(),f=r.attr("data-page")?r.attr("data-page"):1,g=i.pageSize(),p=i.sortDirection(),c=i.sortBy(),u=i.getTotal(),h=i.getMax(),v={},m,b,x,y,P;if(!$(s.loadingSelector).is(".loading")){$(s.loadingSelector).addClass("loading");switch(f){case"first":m=1;break;case"next":m=d+1>h?h:d+1;break;case"prev":m=d-1<1?1:d-1;break;case"last":m=h;break;default:m=parseInt(f)}if(s.ajax){setTimeout(function(){var a=t.attr("data-var-page")||s.vars.page,r=t.attr("data-var-page-size")||s.vars.pageSize,l=t.attr("data-var-sort-by")||s.vars.sortBy,d=t.attr("data-var-sort-direction")||s.vars.sortDirection;v[a]=m;v[r]=g;v[l]=c;v[d]=p;if(b=i.filterForm()){x=b.serialize().split("&");for(P=0;P<x.length;P++){y=x[P].split("=");v[y[0]]=y[1]}}o=typeof s.urlHandler=="function"?s.urlHandler(v,o):$.qs(v,o);$[s.method](o,function(a,r,l){if(typeof s.ajaxHandler=="function"){s.ajaxHandler(i,a,r,l)}else{var o,d=$($(a).find(i.selector)[i.idx]);if(o=d.attr("data-total"))t.attr("data-total",o);if(s.behaviour=="append"&&m!=1){t.append(d.children())}else{t.html("").append(d.children())}}t.attr("data-page",m);if(s.forceFilter)i.filter();i.attachPagination();if(typeof s.onAfterPage=="function")s.onAfterPage.call(n,i,e);$(s.loadingSelector).removeClass("loading")})},s.ajaxWait)}else{t.attr("data-page",m);i.filter();i.attachPagination();if(typeof s.onAfterPage=="function")s.onAfterPage.call(n,i,e);$(s.loadingSelector).removeClass("loading")}}})})},getMax:function(){return Math.ceil(this.getTotal()/this.pageSize())},appendedTotal:function(){var t=this.$element;return t.children().length},getTotal:function(){var t=this.$element;return t.attr("data-total")?parseInt(t.attr("data-total")):t.children().length},currentPage:function(){var t=this.$element;return t.attr("data-page")?parseInt(t.attr("data-page")):1},sortBy:function(){var t=this.$element;return t.attr("data-sort-by")?t.attr("data-sort-by"):null},sortDirection:function(){var t=this.$element;return t.attr("data-sort-direction")=="desc"?"desc":"asc"},baseURL:function(){var t=this.$element,e=this.settings,a=t.attr("data-base-url");if(!a&&t.parent().is("table")){a=t.parent().attr("data-base-url")}return a?a:e.baseUrl},pageSize:function(){var t=this.$element,e=this.settings;return t.attr("data-page-size")?parseInt(t.attr("data-page-size")):e.pageSize},filterForm:function(){var t=this.$element,e=this.settings,a=e.filterFormSelector?$(e.filterFormSelector):null;return t.attr("data-filter-form")?$(t.attr("data-filter-form")):a},getContainer:function(){var t=this.$element;while(t.parent().is("table, tbody, tr")){t=t.parent()}return t},buildPager:function(t){var e,r,i="",n=this.settings,l=this.$element,s=l.attr("id"),o=this.getTotal(),d=n.pager.class!=a&&n.pager.class?n.pager.class:"page-link",f=this.getMax();i='<div id="'+s+'-wrap" class="pagr-wrap">'+(n.pager.first?'<a class="'+d+(t==1?" disabled":"")+'" data-page="first">First</a>':"")+(n.pager.prev?'<a class="'+d+(t==1?" disabled":"")+'" data-page="prev">Prev</a>':"");if(n.pager.range){for(r=-n.pager.range;r<=n.pager.range;r++){e=t+r;if(e>0&&e<=f)i+='<a class="'+d+(t==e?" current":"")+'" data-page="'+e+'">'+e+"</a>"}}i+=(n.pager.next?'<a class="'+d+(t==f?" disabled":"")+'" data-page="next">Next</a>':"")+(n.pager.last?'<a class="'+d+(t==f?" disabled":"")+'" data-page="last">Last</a>':"")+"</div>";return i},filter:function(){var t=this.$element,e=this.settings,a=this.getTotal(),r=this.currentPage(),i=this.pageSize();if(a>i){t.children().each(function(t){var a=$(this);if(e.behaviour!="append"){if(t>=i*(r-1)&&t<i*r)a.show();else a.hide()}else{if(t<i*r)a.show();else a.hide()}})}}};$.q=function(e,a,r){if(!r)r=t.location.href;var i=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi"),n;if(i.test(r)){if(typeof a!=="undefined"&&a!==null)return r.replace(i,"$1"+e+"="+a+"$2$3");else{n=r.split("#");r=n[0].replace(i,"$1$3").replace(/(&|\?)$/,"");if(typeof n[1]!=="undefined"&&n[1]!==null)r+="#"+n[1];return r}}else{if(typeof a!=="undefined"&&a!==null){var l=r.indexOf("?")!==-1?"&":"?";n=r.split("#");r=n[0]+l+e+"="+a;if(typeof n[1]!=="undefined"&&n[1]!==null)r+="#"+n[1];return r}else return r}};$.qs=function(t,e){for(var a in t){e=$.q(a,t[a],e)}return e};$.fn[r]=function(t){var e=this.selector;return this.each(function(a){if(!$.data(this,"plugin_"+r)){$.data(this,"plugin_"+r,new l(this,a,e,t))}})}})(jQuery,window,document);
