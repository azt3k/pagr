;(function($,e,t,a){"use strict";var r="pagr",i="0.1.2",n={loadingSelector:"html",pageLinkSelector:".page-link",filterFormSelector:null,pager:{"class":"page-link",next:true,prev:true,range:3,first:true,last:true},forceFilter:false,ajax:false,method:"get",behaviour:"replace",vars:{sortDirection:"direction",sortBy:"sort",page:"page",pageSize:"page_size"},baseURL:e.location.href,pageSize:10,urlHandler:null,ajaxHandler:null,onBeforePage:null,onAfterPage:null};function s(e,t,a,r){this.$element=$(e);this.idx=t;this.selector=a;this.settings=$.extend(true,{},n,r);this.init()}s.prototype={init:function(){var e=this.$element,t=this.settings,a=e.attr("id");e.addClass("pagr");if(!a){while(!a||$("#"+a).length){a=Math.floor(Math.random()*1e3)+1}e.attr("id",a)}if(["get","post"].indexOf(t.method)==-1)throw"invalid request method supplied";if(["append","replace"].indexOf(t.behaviour)==-1)throw"invalid behaviour supplied";this.attachPagination();if(!t.ajax||t.forceFilter){this.filter()}},attachPagination:function(){var e=this.$element,t,a,r=this,i,n=e.attr("data-page")?parseInt(e.attr("data-page")):1,s=this.settings,l=e.attr("id");if(s.pager){t=this.getContainer();a=$("#"+l+"-wrap");if(a.length)a.replaceWith(r.buildPager(n));else t.after(this.buildPager(n))}$(s.pageLinkSelector).each(function(t){var a=$(this);a.off("tap.pagr").off("click.pagr").on("tap.pagr, click.pagr",function(t){t.preventDefault();if(a.is(".disabled"))return;if(typeof s.onBeforePage=="function")s.onBeforePage(r);var i=r.baseURL(),n=r.currentPage(),l=a.attr("data-page")?a.attr("data-page"):1,o=r.pageSize(),f=r.sortDirection(),d=r.sortBy(),g=r.getTotal(),p=r.getMax(),c={},u,h,v,m,b;if(!$(s.loadingSelector).is(".loading")){$(s.loadingSelector).addClass("loading");switch(l){case"first":u=1;break;case"next":u=n+1>p?p:n+1;break;case"prev":u=n-1<1?1:n-1;break;case"last":u=p;break;default:u=parseInt(l)}if(s.ajax){c[s.vars.page]=u;c[s.vars.pageSize]=o;c[s.vars.sortBy]=d;c[s.vars.sortDirection]=f;if(h=r.filterForm()){v=h.serialize().split("&");for(b=0;b<v.length;b++){m=v[b].split("=");c[m[0]]=m[1]}}i=typeof s.urlHandler=="function"?s.urlHandler(c,i):$.qs(c,i);$[s.method](i,function(t,a,i){if(typeof s.ajaxHandler=="function"){s.ajaxHandler(t,a,i)}else{var n=$($(t).find(r.selector)[r.idx]);if(s.behaviour=="append"){e.append(n.children())}else{e.html("").append(n.children())}}e.attr("data-page",u);if(s.forceFilter)r.filter();r.attachPagination();if(typeof s.onAfterPage=="function")s.onAfterPage(r);$(s.loadingSelector).removeClass("loading")})}else{e.attr("data-page",u);r.filter();r.attachPagination();if(typeof s.onAfterPage=="function")s.onAfterPage(r);$(s.loadingSelector).removeClass("loading")}}})})},getMax:function(){return Math.ceil(this.getTotal()/this.pageSize())},appendedTotal:function(){var e=this.$element;return e.children().length},getTotal:function(){var e=this.$element;return e.attr("data-total")?parseInt(e.attr("data-total")):e.children().length},currentPage:function(){var e=this.$element;return e.attr("data-page")?parseInt(e.attr("data-page")):1},sortBy:function(){var e=this.$element;return e.attr("data-sort-by")?e.attr("data-sort-by"):null},sortDirection:function(){var e=this.$element;return e.attr("data-sort-direction")=="desc"?"desc":"asc"},baseURL:function(){var e=this.$element,t=this.settings;return e.attr("data-base-url")?e.attr("data-base-url"):t.baseUrl},pageSize:function(){var e=this.$element,t=this.settings;return e.attr("data-page-size")?parseInt(e.attr("data-page-size")):t.pageSize},filterForm:function(){var e=this.$element,t=this.settings,a=t.filterFormSelector?$(t.filterFormSelector):null;return e.attr("data-filter-form")?$(e.attr("data-filter-form")):a},getContainer:function(){var e=this.$element;while(e.parent().is("table, tbody, tr")){e=e.parent()}return e},buildPager:function(e){var t,r,i="",n=this.settings,s=this.$element,l=s.attr("id"),o=this.getTotal(),f=n.pager.class!=a&&n.pager.class?n.pager.class:"page-link",d=this.getMax();i='<div id="'+l+'-wrap" class="pagr-wrap">'+(n.pager.first?'<a class="'+f+(e==1?" disabled":"")+'" data-page="first">First</a>':"")+(n.pager.prev?'<a class="'+f+(e==1?" disabled":"")+'" data-page="prev">Prev</a>':"");if(n.pager.range){for(r=-n.pager.range;r<=n.pager.range;r++){t=e+r;if(t>0&&t<=d)i+='<a class="'+f+(e==t?" current":"")+'" data-page="'+t+'">'+t+"</a>"}}i+=(n.pager.next?'<a class="'+f+(e==d?" disabled":"")+'" data-page="next">Next</a>':"")+(n.pager.last?'<a class="'+f+(e==d?" disabled":"")+'" data-page="last">Last</a>':"")+"</div>";return i},filter:function(){var e=this.$element,t=this.settings,a=this.getTotal(),r=this.currentPage(),i=this.pageSize();if(a>i){e.children().each(function(e){var a=$(this);if(t.behaviour!="append"){if(e>=i*(r-1)&&e<i*r)a.show();else a.hide()}else{if(e<i*r)a.show();else a.hide()}})}}};$.q=function(t,a,r){if(!r)r=e.location.href;var i=new RegExp("([?&])"+t+"=.*?(&|#|$)(.*)","gi"),n;if(i.test(r)){if(typeof a!=="undefined"&&a!==null)return r.replace(i,"$1"+t+"="+a+"$2$3");else{n=r.split("#");r=n[0].replace(i,"$1$3").replace(/(&|\?)$/,"");if(typeof n[1]!=="undefined"&&n[1]!==null)r+="#"+n[1];return r}}else{if(typeof a!=="undefined"&&a!==null){var s=r.indexOf("?")!==-1?"&":"?";n=r.split("#");r=n[0]+s+t+"="+a;if(typeof n[1]!=="undefined"&&n[1]!==null)r+="#"+n[1];return r}else return r}};$.qs=function(e,t){for(var a in e){t=$.q(a,e[a],t)}return t};$.fn[r]=function(e){var t=this.selector;return this.each(function(a){if(!$.data(this,"plugin_"+r)){$.data(this,"plugin_"+r,new s(this,a,t,e))}})}})(jQuery,window,document);
