;(function(e,t){if(typeof define==="function"&&define.amd)define(["jquery"],t);else if(typeof exports==="object")module.exports=t(require("jquery"));else{t(e.jQuery)}})(this,function($,e){"use strict";$(function(){var t="pagr",a="0.4.2",r={bindTo:"tap click change",loadingSelector:"html",pageLinkSelector:".page-link",filterFormSelector:null,pager:{"class":"page-link",next:true,prev:true,range:3,first:true,last:true},forceFilter:false,ajax:false,method:"get",behaviour:"replace",vars:{sortDirection:"direction",sortBy:"sort",page:"page",pageSize:"page_size"},baseURL:window.location.href,pageSize:10,ajaxWait:0,urlHandler:null,requestNotifier:null,ajaxHandler:null,onBeforePage:null,onAfterPage:null};function i(e,t,a,i){this.$element=$(e);this.idx=t;this.selector=a;this.settings=$.extend(true,{},r,i);this.init()}i.prototype={init:function(){var e=this.$element,t=this.settings,a=e.attr("id");e.addClass("pagr");if(!a){while(!a||$("#"+a).length){a=Math.floor(Math.random()*1e3)+1}e.attr("id",a)}if(["get","post"].indexOf(t.method)==-1)throw"invalid request method supplied";if(["append","replace"].indexOf(t.behaviour)==-1)throw"invalid behaviour supplied";this.attachPagination();if(!t.ajax||t.forceFilter){this.filter()}},attachPagination:function(){var t=this.$element,a,r,i=this,n,s=t.attr("data-page")?parseInt(t.attr("data-page")):1,l=this.settings,o=t.attr("id");if(l.pager){a=this.getContainer();r=$("#"+o+"-wrap");if(r.length)r.replaceWith(i.buildPager(s));else a.after(this.buildPager(s))}$(l.pageLinkSelector).each(function(a){var r=$(this),n=this,s=r.attr("data-bind-to")||l.bindTo,o=s.split(/[ ]+/).map(function(e){return e+".pagr"}).join(" "),f=i.currentPage(),d=r.attr("data-page")?r.attr("data-page"):1,p=i.getMax(),u=i.parsePageJump(d,f,p);r.toggleClass("disabled",f==p&&d=="next");r.off(o).on(o,function(a){var s=r.attr("data-allow-default");if(s==e||!s||s=="false")a.preventDefault();if(r.is(".disabled"))return;if(typeof l.onBeforePage=="function")l.onBeforePage.call(n,i,a);var o=i.baseURL(),f=i.currentPage(),d=r.attr("data-page")?r.attr("data-page"):1,p=i.pageSize(),u=i.sortDirection(),g=i.sortBy(),c=i.getTotal(),h=i.getMax(),v={},m={},b,x,y,P,w;if(!$(l.loadingSelector).is(".loading")){$(l.loadingSelector).addClass("loading");b=i.parsePageJump(d,f,h);if(l.ajax){setTimeout(function(){var e=t.attr("data-var-page")||l.vars.page,r=t.attr("data-var-page-size")||l.vars.pageSize,s=t.attr("data-var-sort-by")||l.vars.sortBy,f=t.attr("data-var-sort-direction")||l.vars.sortDirection;v[e]=b;v[r]=p;v[s]=g;v[f]=u;if(x=i.filterForm()){m=$.q2obj(x.serialize());$.extend(v,m)}var d=typeof l.urlHandler=="function"?l.urlHandler(v,o):$.qs(v,o);if(typeof l.requestNotifier=="function")l.requestNotifier(i,d,v,o);$[l.method](d,function(e,r,s){if(typeof l.ajaxHandler=="function"){l.ajaxHandler(i,e,r,s)}else{var o,f=$($(e).find(i.selector)[i.idx]);if(o=f.attr("data-total"))t.attr("data-total",o);if(l.behaviour=="append"&&b!=1){t.append(f.children())}else{t.html("").append(f.children())}}t.attr("data-page",b);if(l.forceFilter)i.filter();i.attachPagination();if(typeof l.onAfterPage=="function")l.onAfterPage.call(n,i,a);$(l.loadingSelector).removeClass("loading")})},l.ajaxWait)}else{t.attr("data-page",b);i.filter();i.attachPagination();if(typeof l.onAfterPage=="function")l.onAfterPage.call(n,i,a);$(l.loadingSelector).removeClass("loading")}}})})},parsePageJump:function(e,t,a){var r;switch(e){case"first":r=1;break;case"next":r=t+1>a?a:t+1;break;case"prev":r=t-1<1?1:t-1;break;case"last":r=a;break;default:r=parseInt(e)}return r},getMax:function(){return Math.ceil(this.getTotal()/this.pageSize())},appendedTotal:function(){var e=this.$element;return e.children().length},getTotal:function(){var e=this.$element;return e.attr("data-total")?parseInt(e.attr("data-total")):e.children().length},currentPage:function(){var e=this.$element;return e.attr("data-page")?parseInt(e.attr("data-page")):1},sortBy:function(){var e=this.$element;return e.attr("data-sort-by")?e.attr("data-sort-by"):null},sortDirection:function(){var e=this.$element;return e.attr("data-sort-direction")=="desc"?"desc":"asc"},baseURL:function(){var e=this.$element,t=this.settings,a=e.attr("data-base-url"),r;if(!a&&e.parent().is("table")){a=e.parent().attr("data-base-url")}r=a?a:t.baseUrl;return r?r:window.location.href},pageSize:function(){var e=this.$element,t=this.settings;return e.attr("data-page-size")?parseInt(e.attr("data-page-size")):t.pageSize},filterForm:function(){var e=this.$element,t=this.settings,a=t.filterFormSelector?$(t.filterFormSelector):null;return e.attr("data-filter-form")?$(e.attr("data-filter-form")):a},getContainer:function(){var e=this.$element;while(e.parent().is("table, tbody, tr")){e=e.parent()}return e},buildPager:function(t){var a,r,i="",n=this.settings,s=this.$element,l=s.attr("id"),o=this.getTotal(),f=n.pager.class!=e&&n.pager.class?n.pager.class:"page-link",d=this.getMax();i='<div id="'+l+'-wrap" class="pagr-wrap">'+(n.pager.first?'<a class="'+f+(t==1?" disabled":"")+'" data-page="first">First</a>':"")+(n.pager.prev?'<a class="'+f+(t==1?" disabled":"")+'" data-page="prev">Prev</a>':"");if(n.pager.range){for(r=-n.pager.range;r<=n.pager.range;r++){a=t+r;if(a>0&&a<=d)i+='<a class="'+f+(t==a?" current":"")+'" data-page="'+a+'">'+a+"</a>"}}i+=(n.pager.next?'<a class="'+f+(t==d?" disabled":"")+'" data-page="next">Next</a>':"")+(n.pager.last?'<a class="'+f+(t==d?" disabled":"")+'" data-page="last">Last</a>':"")+"</div>";return i},filter:function(){var e=this.$element,t=this.settings,a=this.getTotal(),r=this.currentPage(),i=this.pageSize();if(a>i){e.children().each(function(e){var a=$(this);if(t.behaviour!="append"){if(e>=i*(r-1)&&e<i*r)a.show();else a.hide()}else{if(e<i*r)a.show();else a.hide()}})}}};$.q2obj=function(e){if(e=="")return null;var t={},a=e.split("&");for(var r=0;r<a.length;r++){var i=a[r].split("="),n=decodeURIComponent(i[0]),s=decodeURIComponent(i[1]);if(typeof t[n]==="undefined"){if(n.substr(n.length-2)!="[]")t[n]=s;else t[n]=[s]}else if(typeof t[n]==="string")t[n]=s;else t[n].push(s)}return t};$.q=function(e,t,a){if(!a)a=window.location.href;var r=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi"),i;if(r.test(a)){if(typeof t!=="undefined"&&t!==null)return a.replace(r,"$1"+e+"="+t+"$2$3");else{i=a.split("#");a=i[0].replace(r,"$1$3").replace(/(&|\?)$/,"");if(typeof i[1]!=="undefined"&&i[1]!==null)a+="#"+i[1];return a}}else{if(typeof t!=="undefined"&&t!==null){var n=a.indexOf("?")!==-1?"&":"?";i=a.split("#");a=i[0]+n+e+"="+t;if(typeof i[1]!=="undefined"&&i[1]!==null)a+="#"+i[1];return a}else return a}};$.qs=function(e,t,a){a=a||false;var r=t.split("?")[0]||t,i=t.split("?")[1]||"",n=$.q2obj(i),s=a?$.extend(true,{},n,e):$.extend({},n,e);return r+"?"+$.param(s)};$.fn[t]=function(e){var a=this.selector;return this.each(function(r){if(!$.data(this,"plugin_"+t)){$.data(this,"plugin_"+t,new i(this,r,a,e))}})}})});
