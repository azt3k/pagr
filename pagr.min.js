;(function($,e,t,a){"use strict";var r="pagr",i="0.1.7",n={loadingSelector:"html",pageLinkSelector:".page-link",filterFormSelector:null,pager:{"class":"page-link",next:true,prev:true,range:3,first:true,last:true},forceFilter:false,ajax:false,method:"get",behaviour:"replace",vars:{sortDirection:"direction",sortBy:"sort",page:"page",pageSize:"page_size"},baseURL:e.location.href,pageSize:10,urlHandler:null,ajaxHandler:null,onBeforePage:null,onAfterPage:null};function l(e,t,a,r){this.$element=$(e);this.idx=t;this.selector=a;this.settings=$.extend(true,{},n,r);this.init()}l.prototype={init:function(){var e=this.$element,t=this.settings,a=e.attr("id");e.addClass("pagr");if(!a){while(!a||$("#"+a).length){a=Math.floor(Math.random()*1e3)+1}e.attr("id",a)}if(["get","post"].indexOf(t.method)==-1)throw"invalid request method supplied";if(["append","replace"].indexOf(t.behaviour)==-1)throw"invalid behaviour supplied";this.attachPagination();if(!t.ajax||t.forceFilter){this.filter()}},attachPagination:function(){var e=this.$element,t,r,i=this,n,l=e.attr("data-page")?parseInt(e.attr("data-page")):1,s=this.settings,o=e.attr("id");if(s.pager){t=this.getContainer();r=$("#"+o+"-wrap");if(r.length)r.replaceWith(i.buildPager(l));else t.after(this.buildPager(l))}$(s.pageLinkSelector).each(function(t){var r=$(this);r.off("tap.pagr").off("click.pagr").on("tap.pagr, click.pagr",function(t){var n=r.attr("data-allow-default");if(n==a||!n||n=="false")t.preventDefault();if(r.is(".disabled"))return;if(typeof s.onBeforePage=="function")s.onBeforePage(i);var l=i.baseURL(),o=i.currentPage(),f=r.attr("data-page")?r.attr("data-page"):1,d=i.pageSize(),g=i.sortDirection(),p=i.sortBy(),c=i.getTotal(),u=i.getMax(),h={},v,m,b,x,P;if(!$(s.loadingSelector).is(".loading")){$(s.loadingSelector).addClass("loading");switch(f){case"first":v=1;break;case"next":v=o+1>u?u:o+1;break;case"prev":v=o-1<1?1:o-1;break;case"last":v=u;break;default:v=parseInt(f)}if(s.ajax){h[s.vars.page]=v;h[s.vars.pageSize]=d;h[s.vars.sortBy]=p;h[s.vars.sortDirection]=g;if(m=i.filterForm()){b=m.serialize().split("&");for(P=0;P<b.length;P++){x=b[P].split("=");h[x[0]]=x[1]}}l=typeof s.urlHandler=="function"?s.urlHandler(h,l):$.qs(h,l);$[s.method](l,function(t,a,r){if(typeof s.ajaxHandler=="function"){s.ajaxHandler(i,t,a,r)}else{var n,l=$($(t).find(i.selector)[i.idx]);if(n=l.attr("data-total"))e.attr("data-total",n);if(s.behaviour=="append"&&v!=1){e.append(l.children())}else{e.html("").append(l.children())}}e.attr("data-page",v);if(s.forceFilter)i.filter();i.attachPagination();if(typeof s.onAfterPage=="function")s.onAfterPage(i);$(s.loadingSelector).removeClass("loading")})}else{e.attr("data-page",v);i.filter();i.attachPagination();if(typeof s.onAfterPage=="function")s.onAfterPage(i);$(s.loadingSelector).removeClass("loading")}}})})},getMax:function(){return Math.ceil(this.getTotal()/this.pageSize())},appendedTotal:function(){var e=this.$element;return e.children().length},getTotal:function(){var e=this.$element;return e.attr("data-total")?parseInt(e.attr("data-total")):e.children().length},currentPage:function(){var e=this.$element;return e.attr("data-page")?parseInt(e.attr("data-page")):1},sortBy:function(){var e=this.$element;return e.attr("data-sort-by")?e.attr("data-sort-by"):null},sortDirection:function(){var e=this.$element;return e.attr("data-sort-direction")=="desc"?"desc":"asc"},baseURL:function(){var e=this.$element,t=this.settings,a=e.attr("data-base-url");if(!a&&e.parent().is("table")){a=e.parent().attr("data-base-url")}return a?a:t.baseUrl},pageSize:function(){var e=this.$element,t=this.settings;return e.attr("data-page-size")?parseInt(e.attr("data-page-size")):t.pageSize},filterForm:function(){var e=this.$element,t=this.settings,a=t.filterFormSelector?$(t.filterFormSelector):null;return e.attr("data-filter-form")?$(e.attr("data-filter-form")):a},getContainer:function(){var e=this.$element;while(e.parent().is("table, tbody, tr")){e=e.parent()}return e},buildPager:function(e){var t,r,i="",n=this.settings,l=this.$element,s=l.attr("id"),o=this.getTotal(),f=n.pager.class!=a&&n.pager.class?n.pager.class:"page-link",d=this.getMax();i='<div id="'+s+'-wrap" class="pagr-wrap">'+(n.pager.first?'<a class="'+f+(e==1?" disabled":"")+'" data-page="first">First</a>':"")+(n.pager.prev?'<a class="'+f+(e==1?" disabled":"")+'" data-page="prev">Prev</a>':"");if(n.pager.range){for(r=-n.pager.range;r<=n.pager.range;r++){t=e+r;if(t>0&&t<=d)i+='<a class="'+f+(e==t?" current":"")+'" data-page="'+t+'">'+t+"</a>"}}i+=(n.pager.next?'<a class="'+f+(e==d?" disabled":"")+'" data-page="next">Next</a>':"")+(n.pager.last?'<a class="'+f+(e==d?" disabled":"")+'" data-page="last">Last</a>':"")+"</div>";return i},filter:function(){var e=this.$element,t=this.settings,a=this.getTotal(),r=this.currentPage(),i=this.pageSize();if(a>i){e.children().each(function(e){var a=$(this);if(t.behaviour!="append"){if(e>=i*(r-1)&&e<i*r)a.show();else a.hide()}else{if(e<i*r)a.show();else a.hide()}})}}};$.q=function(t,a,r){if(!r)r=e.location.href;var i=new RegExp("([?&])"+t+"=.*?(&|#|$)(.*)","gi"),n;if(i.test(r)){if(typeof a!=="undefined"&&a!==null)return r.replace(i,"$1"+t+"="+a+"$2$3");else{n=r.split("#");r=n[0].replace(i,"$1$3").replace(/(&|\?)$/,"");if(typeof n[1]!=="undefined"&&n[1]!==null)r+="#"+n[1];return r}}else{if(typeof a!=="undefined"&&a!==null){var l=r.indexOf("?")!==-1?"&":"?";n=r.split("#");r=n[0]+l+t+"="+a;if(typeof n[1]!=="undefined"&&n[1]!==null)r+="#"+n[1];return r}else return r}};$.qs=function(e,t){for(var a in e){t=$.q(a,e[a],t)}return t};$.fn[r]=function(e){var t=this.selector;return this.each(function(a){if(!$.data(this,"plugin_"+r)){$.data(this,"plugin_"+r,new l(this,a,t,e))}})}})(jQuery,window,document);
